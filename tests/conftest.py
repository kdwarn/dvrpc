import pytest

from bicycles import create_app, models, db
from config import TestConfig


dummy_data = [
    {
        "x": -75.172272,
        "y": 39.9546,
        "objectid": 50784,
        "recordnum": 140313,
        "setdate": "2018-03-12T20:00:00Z",
        "setyear": 2018,
        "comments": "",
        "mcd": 4210160103,
        "route": "3",
        "road": "j f kennedy blvd north side",
        "cntdir": "west",
        "fromlmt": "20th st",
        "tolmt": "19th st",
        "type": "Bicycle 2",
        "latitude": 39.954592,
        "longitude": -75.17227,
        "factor": 0,
        "axle": 1.02,
        "outdir": "E",
        "indir": "W",
        "aadb": 123,
        "updated": "2018-06-28T22:36:28Z",
        "co_name": "Philadelphia",
        "mun_name": "Central",
        "globalid": "94b0c8bc-c786-4527-a943-b0b5ed62410b",
        "program": "Project",
        "bikepedgro": "Mixed",
        "bikepedfac": "Mixed Traffic",
        "geom": "0101000020E61000003E05C07806CB52C0F982161230FA4340",
    },
    {
        "x": -75.166286,
        "y": 39.95267,
        "objectid": 50794,
        "recordnum": 140302,
        "setdate": "2018-03-13T20:00:00Z",
        "setyear": 2018,
        "comments": "",
        "mcd": 4210160103,
        "route": "3",
        "road": "market st south side",
        "cntdir": "east",
        "fromlmt": "16th st",
        "tolmt": "15th st",
        "type": "Bicycle 2",
        "latitude": 39.952662,
        "longitude": -75.166284,
        "factor": 0,
        "axle": 1.02,
        "outdir": "W",
        "indir": "E",
        "aadb": 394,
        "updated": "2018-06-28T22:36:28Z",
        "co_name": "Philadelphia",
        "mun_name": "Central",
        "globalid": "f57b8819-0f9a-4edf-aa44-5a6fc5503af8",
        "program": "Project",
        "bikepedgro": "Mixed",
        "bikepedfac": "Mixed Traffic",
        "geom": "0101000020E61000004776A565A4CA52C02B1213D4F0F94340",
    },
    {
        "x": -75.188927,
        "y": 39.939555,
        "objectid": 50304,
        "recordnum": 139020,
        "setdate": "2018-04-03T20:00:00Z",
        "setyear": 2018,
        "comments": "",
        "mcd": 4210160112,
        "route": "0",
        "road": "grays ferry ave westbound lanes",
        "cntdir": "west",
        "fromlmt": "ellsworth st",
        "tolmt": "washington ave",
        "type": "Bicycle 2",
        "latitude": 39.939547,
        "longitude": -75.188925,
        "factor": 0,
        "axle": 1.02,
        "outdir": "E",
        "indir": "W",
        "aadb": 125,
        "updated": "2018-06-22T22:36:43Z",
        "co_name": "Philadelphia",
        "mun_name": "South",
        "globalid": "d19ea187-a066-4d86-9fc2-27f36c49b9b9",
        "program": "Project",
        "bikepedgro": "Mixed",
        "bikepedfac": "Bike Lane",
        "geom": "0101000020E61000006519E25817CC52C007077B1343F84340",
    },
    {
        "x": -74.993638,
        "y": 39.828379,
        "objectid": 48016,
        "recordnum": 137287,
        "setdate": "2018-04-09T20:00:00Z",
        "setyear": 2018,
        "comments": "",
        "mcd": 3400740440,
        "route": "702",
        "road": "berlin ave westbound lanes",
        "cntdir": "west",
        "fromlmt": "pinelawn ave",
        "tolmt": "shady side ave",
        "type": "Bicycle 2",
        "latitude": 39.828371,
        "longitude": -74.993636,
        "factor": 0,
        "axle": 0.0,
        "outdir": "E",
        "indir": "W",
        "aadb": 14,
        "updated": "2018-04-24T22:36:08Z",
        "co_name": "Camden",
        "mun_name": "Lindenwold Borough",
        "globalid": "ca0cd510-376e-4b3f-b2d1-59076d8ef81c",
        "program": "Cyclical",
        "bikepedgro": "Low Volume",
        "bikepedfac": "",
        "geom": "0101000020E6100000350873BB97BF52C037FA980F08EA4340",
    },
    {
        "x": -75.158972,
        "y": 39.981638,
        "objectid": 48017,
        "recordnum": 141908,
        "setdate": "2018-04-11T20:00:00Z",
        "setyear": 2018,
        "comments": "",
        "mcd": 4210160107,
        "route": "0",
        "road": "15th st",
        "cntdir": "south",
        "fromlmt": "montgomery ave",
        "tolmt": "norris st",
        "type": "Bicycle 2",
        "latitude": 39.98163,
        "longitude": -75.15897,
        "factor": 0,
        "axle": 0.0,
        "outdir": "N",
        "indir": "S",
        "aadb": 56,
        "updated": "2018-04-24T22:36:08Z",
        "co_name": "Philadelphia",
        "mun_name": "Lower North",
        "globalid": "0e9c3be4-4295-4200-9242-521228d3a630",
        "program": "Project",
        "bikepedgro": "Mixed",
        "bikepedfac": "Sharrow",
        "geom": "0101000020E6100000E3C281902CCA52C0E162450DA6FD4340",
    },
    {
        "x": -75.625261,
        "y": 40.026727,
        "objectid": 48022,
        "recordnum": 141911,
        "setdate": "2018-04-12T20:00:00Z",
        "setyear": 2018,
        "comments": "",
        "mcd": 4202984192,
        "route": None,
        "road": "chester valley trail",
        "cntdir": "both",
        "fromlmt": "exton park trailhead",
        "tolmt": "church farm la",
        "type": "Bicycle 2",
        "latitude": 40.026719,
        "longitude": -75.625259,
        "factor": 0,
        "axle": 0.0,
        "outdir": "S",
        "indir": "N",
        "aadb": 339,
        "updated": "2018-04-27T22:36:51Z",
        "co_name": "Chester",
        "mun_name": "West Whiteland Township",
        "globalid": "434d7aa6-de2c-4aee-b250-38ede0f60538",
        "program": "Project",
        "bikepedgro": "Recreation",
        "bikepedfac": "Multiuse Trail",
        "geom": "0101000020E6100000E621533E04E852C0469737876B034440",
    },
    {
        "x": -75.070945,
        "y": 39.809924,
        "objectid": 50327,
        "recordnum": 137274,
        "setdate": "2018-04-17T20:00:00Z",
        "setyear": 2018,
        "comments": "",
        "mcd": 3400726760,
        "route": "0",
        "road": "blackwood recreational path",
        "cntdir": "both",
        "fromlmt": "crestview ave",
        "tolmt": "cr 706 almonesson rd",
        "type": "Bicycle 2",
        "latitude": 39.809916,
        "longitude": -75.070943,
        "factor": 0,
        "axle": 1.02,
        "outdir": "N",
        "indir": "S",
        "aadb": 321,
        "updated": "2018-06-22T22:36:43Z",
        "co_name": "Camden",
        "mun_name": "Gloucester Township",
        "globalid": "bd2fa6b8-8f49-4d80-a132-43c461bb949f",
        "program": "Cyclical",
        "bikepedgro": "Recreation",
        "bikepedfac": "Multiuse Trail",
        "geom": "0101000020E6100000543882548AC452C0EA40D653ABE74340",
    },
    {
        "x": -75.139865,
        "y": 39.992101,
        "objectid": 50844,
        "recordnum": 142007,
        "setdate": "2018-05-15T20:00:00Z",
        "setyear": 2018,
        "comments": "Cyclical Program Year 3",
        "mcd": 4210160107,
        "route": "0",
        "road": "lehigh ave westbound lanes",
        "cntdir": "west",
        "fromlmt": "5th st",
        "tolmt": "orkney st",
        "type": "Bicycle 2",
        "latitude": 39.992093,
        "longitude": -75.139864,
        "factor": 0,
        "axle": 1.02,
        "outdir": "E",
        "indir": "W",
        "aadb": 125,
        "updated": "2018-07-11T22:36:35Z",
        "co_name": "Philadelphia",
        "mun_name": "Lower North",
        "globalid": "9a5e4f35-a48f-47b3-9f5f-6a491cc0d351",
        "program": "Cyclical",
        "bikepedgro": "Low Volume",
        "bikepedfac": "Bike Lane",
        "geom": "0101000020E6100000D1782288F3C852C096CB46E7FCFE4340",
    },
    {
        "x": -75.181108,
        "y": 39.949179,
        "objectid": 50789,
        "recordnum": 142000,
        "setdate": "2018-05-21T20:00:00Z",
        "setyear": 2018,
        "comments": "Cyclical Program Year 3",
        "mcd": 4210160103,
        "route": "0",
        "road": "s 25th st northbound lanes",
        "cntdir": "north",
        "fromlmt": "spruce st",
        "tolmt": "locust st",
        "type": "Bicycle 2",
        "latitude": 39.949171,
        "longitude": -75.181106,
        "factor": 0,
        "axle": 1.02,
        "outdir": "S",
        "indir": "N",
        "aadb": 434,
        "updated": "2018-06-28T22:36:28Z",
        "co_name": "Philadelphia",
        "mun_name": "Central",
        "globalid": "12219436-cc1c-4ffd-848c-5e1dd54a4dcd",
        "program": "Cyclical",
        "bikepedgro": "Mixed",
        "bikepedfac": "Mixed Traffic",
        "geom": "0101000020E610000000C79E3D97CB52C0E3A7716F7EF94340",
    },
    {
        "x": -74.664815,
        "y": 40.351373,
        "objectid": 52805,
        "recordnum": 142905,
        "setdate": "2018-11-07T19:00:00-05:00",
        "setyear": 2018,
        "comments": "",
        "mcd": 3402160900,
        "route": "0",
        "road": "paul robeson pl eastbound lanes",
        "cntdir": "north",
        "fromlmt": "us 206 bayard la",
        "tolmt": "chambers terr",
        "type": "Bicycle 2",
        "latitude": 40.351365,
        "longitude": -74.664813,
        "factor": 0,
        "axle": 0.0,
        "outdir": "E",
        "indir": "W",
        "aadb": 51,
        "updated": "2019-01-23T21:36:39-05:00",
        "co_name": "Mercer",
        "mun_name": "Princeton",
        "globalid": "251645a8-5d5b-407c-83f8-b7f99979a1c7",
        "program": "Project",
        "bikepedgro": "Mixed",
        "bikepedfac": "Mixed Traffic",
        "geom": "0101000020E6100000293DD34B8CAA52C0C2FA3F87F92C4440",
    }
]


@pytest.fixture
def flask_client():
    test_app = create_app(config_class=TestConfig)
    flask_client = test_app.test_client()

    with test_app.app_context():
        db.create_all()
        
        db.session.bulk_insert_mappings(models.BicycleCount, dummy_data)

        yield flask_client

        db.session.remove()
        db.drop_all()
